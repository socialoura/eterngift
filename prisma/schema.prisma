generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("admin")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Product {
  id          Int         @id @default(autoincrement())
  name        String
  description String?     @db.Text
  priceUsd    Decimal     @map("price_usd") @db.Decimal(10, 2)
  imageUrl    String?     @map("image_url")
  imagesUrl   String[]    @map("images_url")
  category    String?
  stock       Int         @default(0)
  rating      Decimal?    @db.Decimal(3, 2)
  reviewCount Int         @default(0) @map("review_count")
  status      String      @default("active")
  badge       String?
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  orderItems  OrderItem[]

  @@map("products")
}

model Order {
  id                    Int         @id @default(autoincrement())
  orderNumber           String      @unique @map("order_number")
  customerEmail         String      @map("customer_email")
  customerName          String      @map("customer_name")
  customerCurrency      String      @default("USD") @map("customer_currency")
  subtotalUsd           Decimal     @map("subtotal_usd") @db.Decimal(10, 2)
  taxUsd                Decimal     @default(0) @map("tax_usd") @db.Decimal(10, 2)
  totalUsd              Decimal     @map("total_usd") @db.Decimal(10, 2)
  totalDisplayed        Decimal?    @map("total_displayed") @db.Decimal(10, 2)
  exchangeRate          Decimal?    @map("exchange_rate") @db.Decimal(10, 6)
  shippingAddressStreet String?     @map("shipping_address_street")
  shippingAddressCity   String?     @map("shipping_address_city")
  shippingAddressPostal String?     @map("shipping_address_postal")
  shippingAddressCountry String?    @map("shipping_address_country")
  paymentMethod         String      @map("payment_method")
  paymentId             String?     @map("payment_id")
  status                String      @default("pending")
  emailSent             Boolean     @default(false) @map("email_sent")
  discordNotified       Boolean     @default(false) @map("discord_notified")
  createdAt             DateTime    @default(now()) @map("created_at")
  updatedAt             DateTime    @updatedAt @map("updated_at")
  orderItems            OrderItem[]

  @@map("orders")
}

model OrderItem {
  id          Int      @id @default(autoincrement())
  orderId     Int      @map("order_id")
  productId   Int      @map("product_id")
  productName String   @map("product_name")
  priceUsd    Decimal  @map("price_usd") @db.Decimal(10, 2)
  quantity    Int
  totalUsd    Decimal  @map("total_usd") @db.Decimal(10, 2)
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product  @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model CurrencyRate {
  id        Int      @id @default(autoincrement())
  currency  String   @unique
  rate      Decimal  @db.Decimal(10, 6)
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("currency_rates")
}
